<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <report id="report_invoice_reception"
                string="Reception"
                model="account.invoice"
                report_type="qweb-pdf"
                name="l10n_ro_invoice_report.l10n_ro_report_invoice_reception"
                file="l10n_ro_invoice_report.l10n_ro_report_invoice_reception"/>

        <template id="l10n_ro_report_invoice" inherit_id="account.report_invoice">
            <xpath expr="." position="inside">
                <t t-if="False">
                    <t t-call="account.report_invoice_document"/>
                </t>
            </xpath>
        </template>

        <template id="invoice_layout">
            <t t-call="web.internal_layout">
                <!-- Multicompany -->
                <t t-if="not o and doc">
                    <t t-set="o" t-value="doc"/>
                </t>

                <t t-if="o and 'company_id' in o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                    <t t-set="res_company" t-value="o.company_id.sudo()"/>
                </t>
                <t t-if="not o or not 'company_id' in o">
                    <t t-set="company" t-value="res_company"/>
                </t>

                <div>
                    <div class="row" customize_show="True">
                        <div class="col-xs-3">
                            <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % to_text(company.logo)"
                                 style="max-height: 45px;"/>
                        </div>

                    </div>
                    <div class="row zero_min_height">
                        <div class="col-xs-12">
                            <div style="border-bottom: 1px solid black;"/>
                        </div>
                    </div>

                    <table class="table table-condensed" style="border-top: initial;">
                        <tr>
                            <td width="50%">
                                <div>
                                    <strong t-if="o.type in ['out_invoice', 'out_refund']">Supplier</strong>
                                    <strong t-if="o.type in ['in_invoice', 'in_refund']">Customer</strong>
                                </div>
                                <strong t-field="res_company.partner_id.name"/>
                                <div>
                                    <strong>Address:</strong>
                                    <address t-field="res_company.partner_id"
                                             t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;,&quot;phone&quot;, &quot;fax&quot;, &quot;email&quot;], &quot;no_marker&quot;: false, &quot;no_tag_br&quot;: true}"/>
                                </div>

                                <t t-set="partner_id" t-value="res_company.partner_id"/>
                                <t t-call="base.banks"/>

                            </td>
                            <td width="50%">
                                <div>
                                    <strong t-if="o.type in ['out_invoice', 'out_refund']">Customer</strong>
                                    <strong t-if="o.type in ['in_invoice', 'in_refund']">Supplier</strong>
                                </div>
                                <div>
                                    <strong t-field="o.commercial_partner_id.name"/>
                                </div>
                                <div>
                                    <strong>Address:</strong>
                                    <address t-field="o.commercial_partner_id"
                                             t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;phone&quot;, &quot;fax&quot;, &quot;email&quot;], &quot;no_marker&quot;: false, &quot;no_tag_br&quot;: true}"/>
                                </div>

                                <t t-set="partner_id" t-value="o.commercial_partner_id"/>
                                <t t-call="base.banks"/>

                            </td>
                        </tr>
                        <tr>
                            <td style="border-top: initial;">
                                <div t-if="res_company.partner_id.vat">
                                    <strong>CIF:</strong>
                                    <span t-field="res_company.partner_id.vat"/>
                                </div>
                                <div t-if="res_company.partner_id.nrc">
                                    <strong>NRC:</strong>
                                    <span t-field="res_company.partner_id.nrc"/>
                                </div>
                                <div t-if="res_company.share_capital">
                                    <strong>Share Capital:</strong>
                                    <span t-field="res_company.share_capital"/>
                                </div>
                                <div t-if="'vat_on_payment' in res_company._fields">
                                    <div t-if="res_company.vat_on_payment">
                                        <span>Vat on payment</span>
                                    </div>
                                </div>
                                <div>
                                    <span t-esc="', '.join(map(lambda x: (x.tax_id.description or x.tax_id.name), o.tax_line_ids))"/>
                                </div>
                            </td>
                            <td style="border-top: initial;">
                                <div t-if="o.commercial_partner_id.vat">
                                    <strong>CIF:</strong>
                                    <span t-field="o.commercial_partner_id.vat"/>
                                </div>
                                <div t-if="o.commercial_partner_id.nrc">
                                    <strong>NRC:</strong>
                                    <span t-field="o.commercial_partner_id.nrc"/>
                                </div>
                            </td>
                        </tr>
                    </table>

                    <h4 class="text-center">
                        <span t-if="o.type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')">Invoice</span>
                        <span t-if="o.type == 'out_invoice' and o.state == 'proforma2'">PRO-FORMA</span>
                        <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                        <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                        <span t-if="o.type == 'out_refund'">Refund Invoice</span>
                        <span t-if="o.type == 'in_refund'">Supplier Refund</span>
                        <span t-if="o.type == 'in_invoice'">Supplier Invoice</span>
                        <t t-if="o.number">
                            <span t-field="o.number"/>
                        </t>
                        <t t-if="not o.number">
                            <span t-field="o.move_name"/>
                        </t>
                        <span>/</span>
                        <span t-field="o.date_invoice"/>
                    </h4>
                    <div t-if="company.watermark_image" class="mb32 col-md-12">
                        <img t-att-src="'data:image/png;base64,%s' % company.watermark_image"
                             style="width:100%;text-align:center;position:absolute;opacity:0.05"/>
                    </div>
                </div>

                <div>
                    <t t-raw="0"/>
                </div>

            </t>
        </template>

        <template id="l10n_ro_report_invoice_document_with_payments"
                  inherit_id="account.report_invoice_document_with_payments">

            <xpath expr="//div[@name='reference']" position="after">
                <div t-if="o.type == 'out_invoice' and o.payment_ids">
                    <br/>
                    <br/>
                    <div t-foreach="o.payment_ids" t-as="payment" style="border-top: 1px solid black;">

                        <t t-if="payment.payment_type == 'inbound' and payment.journal_id.type == 'cash'">

                            <div>
                                <strong t-field="res_company.partner_id.name"/>
                            </div>
                            <div>
                                VAT:
                                <span t-field="res_company.partner_id.vat"/>
                            </div>
                            <div>
                                NRC:
                                <span t-field="res_company.partner_id.nrc"/>
                            </div>
                            <address t-field="res_company.partner_id"
                                     t-field-options='{"widget": "contact", "fields": ["address"], "no_marker": true, "no_tag_br": true}'/>
                            <h4>
                                <span>Voucher:</span>
                                <span t-field="payment.name"/>
                                <span>/</span>
                                <span t-field="payment.payment_date"/>
                            </h4>
                            <div>
                                <span>I received from</span>
                                <strong t-field="o.partner_id.name"/>
                                <span t-if="o.partner_id.city">
                                    from
                                    <span t-field="o.partner_id.city"/>
                                    <span t-field="o.partner_id.street"/>
                                    <span t-field="o.partner_id.street2"/>
                                </span>
                                ,
                                <span>amount</span>

                                <span t-field="payment.amount"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                (
                                <span t-esc="convert(payment.amount)"/>
                                )
                            </div>
                            <div>
                                Representing counter value of invoice
                                <span t-field="o.number"/>
                            </div>

                        </t>

                    </div>
                </div>
            </xpath>
        </template>

        <template id="l10n_ro_report_invoice_document" inherit_id="account.report_invoice_document">
            <xpath expr="//t[@t-call='web.external_layout']" position="replace">
                <t t-call="l10n_ro_invoice_report.invoice_layout">
                    <div class="page">
                        <div name="invoice_address"></div>
                        <h2/>
                        <t t-set="nr_crt" t-value="1"/>
                        <t t-if="not currency_id">
                            <t t-set="currency_id" t-value="o.currency_id"/>
                        </t>

                        <div class="row" t-if="o.type == 'out_invoice'">
                            <t t-set="pickings" t-value="get_pickings(o)"/>

                            <div id="delivery" class="col-xs-12" t-if="pickings">
                                <span>Deliveries:</span>
                                <t t-foreach="pickings" t-as="d">
                                    <span t-field="d.name"/>
                                </t>
                            </div>
                        </div>

                        <div class="row" t-if="o.type == 'in_invoice'">
                            <t t-set="pickings" t-value="get_pickings(o)"/>

                            <div class="col-xs-12" t-if="pickings">
                                <span>Receptions:</span>
                                <t t-foreach="pickings" t-as="d">
                                    <span t-field="d.name"/>
                                </t>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <span>Reference:</span>
                                <span t-field="o.reference"/>
                            </div>
                        </div>
                        <table class="table table-condensed table-bordered">
                            <thead>
                                <tr>
                                    <th>Ord</th>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th class="text-right">Unit Price</th>
                                    <th class="text-right" t-if="with_discount(o)"
                                        groups="sale.group_discount_per_so_line">Discount (%)
                                    </th>
                                    <th class="text-right">Amount</th>
                                    <th class="text-right">VAT</th>
                                </tr>
                            </thead>
                            <tbody class="invoice_tbody">
                                <tr t-foreach="o.invoice_line_ids" t-as="l">
                                    <td>
                                        <t t-esc="nr_crt"/>
                                        <t t-set="nr_crt" t-value="nr_crt + 1"/>
                                    </td>
                                    <td>
                                        <span t-field="l.name"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-set="quantity" t-value="l.quantity"/>
                                        <t t-if="o.type == 'out_refund'">
                                            <t t-set="quantity" t-value="-1*l.quantity"/>
                                        </t>

                                        <span t-if="quantity" id="quantity" t-esc="formatLang(quantity)"/>
                                        <span t-field="l.uom_id" groups="product.group_uom"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-set="price_unit_without_taxes" t-value="l.price_unit_without_taxes"/>
                                        <t t-set="price_unit_without_taxes"
                                           t-value="o.currency_id.with_context(date=o.date_invoice).compute(price_unit_without_taxes,currency_id)"/>
                                        <span id="price_unit_without_taxes"
                                              t-esc="formatLang(price_unit_without_taxes)"/>
                                    </td>
                                    <td class="text-right" t-if="with_discount(o)"
                                        groups="sale.group_discount_per_so_line">
                                        <span t-field="l.discount"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-set="price_subtotal" t-value="l.price_subtotal"/>
                                        <t t-if="o.type == 'out_refund'">
                                            <t t-set="price_subtotal" t-value="-1*l.price_subtotal"/>
                                        </t>
                                        <t t-set="price_subtotal"
                                           t-value="o.currency_id.with_context(date=o.date_invoice).compute(price_subtotal,currency_id)"/>
                                        <span id="price_subtotal" t-esc="formatLang(price_subtotal)"/>
                                    </td>
                                    <td class="text-right">
                                        <t t-set="price_taxes" t-value="l.price_taxes"/>
                                        <t t-if="o.type == 'out_refund'">
                                            <t t-set="price_taxes" t-value="-1*l.price_taxes"/>

                                        </t>
                                        <t t-set="price_taxes"
                                           t-value="o.currency_id.with_context(date=o.date_invoice).compute(price_taxes,currency_id)"/>
                                        <span id="price_taxes" t-esc="formatLang(price_taxes)"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="page-break-inside: avoid !important;">
                            <div class="row">

                                <div class="col-xs-8" t-if="o.type == 'out_invoice' or o.type == 'out_refund' ">
                                    <table id="signature" class="table table-condensed">

                                        <tr class="border-black">
                                            <td>Elaborate:</td>
                                            <td>Information for delivery:</td>
                                        </tr>

                                        <tr class="border-black">
                                            <td>
                                                <span>Name:</span>
                                                <span t-field="o.user_id"/>
                                            </td>
                                            <td>
                                                <div>
                                                    <span>Delegate:</span>
                                                    <span t-field="o.delegate_id"/>
                                                </div>
                                                <div>
                                                    <span>Mean Transport:</span>
                                                    <span t-field="o.mean_transp"/>
                                                </div>
                                                <div>
                                                    <span>Signature for receive</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="col-xs-4 pull-right">
                                    <table class="table table-condensed">
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total Without VAT</strong>
                                            </td>
                                            <td class="text-right">
                                                <t t-set="amount_untaxeds" t-value="o.amount_untaxed"/>
                                                <t t-if="o.type == 'out_refund'">
                                                    <t t-set="amount_untaxeds" t-value="-1*o.amount_untaxed"/>

                                                </t>

                                                <span id="amount_untaxeds">
                                                    <!--<span t-esc="formatLang(amount_untaxeds)"/>-->
                                                    <!--<span t-field="currency_id.symbol"/>-->
                                                    <span t-esc="amount_untaxeds"
                                                          t-options='{"widget": "monetary", "display_currency": currency_id}'/>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>VAT</td>
                                            <td class="text-right">
                                                <t t-set="amount_tax" t-value="o.amount_tax"/>
                                                <t t-if="o.type == 'out_refund'">
                                                    <t t-set="amount_tax" t-value="-1*o.amount_tax"/>
                                                </t>

                                                <span id="amount_tax">
                                                    <!--<span t-esc="formatLang(amount_tax)"/>-->
                                                    <!--<span t-field="currency_id.symbol"/>-->
                                                    <span t-esc="amount_tax"
                                                          t-options='{"widget": "monetary", "display_currency": currency_id}'/>
                                                </span>

                                            </td>
                                        </tr>
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total</strong>
                                            </td>
                                            <td class="text-right">
                                                <t t-set="amount_total" t-value="o.amount_total"/>
                                                <t t-if="o.type == 'out_refund'">
                                                    <t t-set="amount_total" t-value="-1*o.amount_total"/>

                                                </t>

                                                <span id="amount_total">

                                                    <!-- <span t-esc="formatLang(amount_total)"/>
                                                     <span t-field="currency_id.symbol"/>-->
                                                    <span t-esc="amount_total"
                                                          t-options='{"widget": "monetary", "display_currency": currency_id}'/>
                                                </span>

                                                <div t-if="currency_id!=res_company.currency_id">
                                                    (
                                                    <t t-if="o.type == 'out_refund'">
                                                        <t t-set="amount_total" t-value="-1*o.move_id.amount"/>
                                                        <t t-esc="amount_total"/>
                                                        <span t-field="res_company.currency_id.symbol"/>
                                                    </t>
                                                    <t t-if="not o.type == 'out_refund'">
                                                        <span t-field="o.move_id.amount"
                                                              t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/>

                                                    </t>

                                                    )
                                                </div>

                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>


                            <div class="clearfix">
                                <div id="total" class="row">
                                    <div class="col-xs-4 pull-right">
                                        <table class="table table-condensed" style="min-width: 250px;max-width: 400px;">
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <p t-if="o.comment">
                                <strong>Comment:</strong>
                                <span t-field="o.comment"/>
                            </p>

                            <small t-if="o.type == 'out_invoice' or o.type == 'out_refund'">
                                <div>Printing and numbering system of its own under Law 571/2003 on the Fiscal Code,
                                    with subsequent amendments and OMPF 2226/2006
                                </div>

                                <t t-if="not res_company.stamp_image">
                                    <div>Invoice circulate without signature and stamp according to the law 571/2003,
                                        rule 115, paragraph 6
                                    </div>
                                </t>
                                <img t-if="res_company.stamp_image"
                                     t-att-src="'data:image/png;base64,%s' % res_company.stamp_image"
                                     style="max-height: 150px; "/>
                            </small>

                            <div t-if="o.commercial_partner_id.info_for_invoice">
                                <span t-field="o.commercial_partner_id.info_for_invoice"/>
                            </div>


                            <p id="payment-term" t-if="o.payment_term_id.note">
                                <strong>Payment Term:</strong>
                                <span t-field="o.payment_term_id.note"/>
                            </p>
                            <!--         <p t-if="o.fiscal_position_id.note">
                                         <strong>Fiscal Position Remark:</strong>
                                         <span t-field="o.fiscal_position_id.note"/>
                                     </p>-->
                            <div name="reference" t-if="o.reference and o.type == 'in_invoice'">
                                <strong>Reference:</strong>
                                <p t-field="o.reference"/>
                            </div>
                        </div>
                    </div>
                </t>
            </xpath>
        </template>

        <template id="report_address">
            <t t-set="res_company" t-value="o.company_id"/>
            <div class="row">
                <div class="col-xs-5">
                    <div>
                        <div>
                            <strong>Company</strong>
                        </div>
                    </div>
                    <strong t-field="res_company.partner_id.name"/>
                    <div>
                        <strong>Address:</strong>
                        <address t-field="res_company.partner_id"
                                 t-options='{"widget": "contact", "fields": ["address","phone", "fax"], "no_marker": false, "no_tag_br": true}'/>
                    </div>
                </div>
                <div class="col-xs-5 col-xs-offset-2">
                    <div>
                        <div>
                            <strong>Supplier</strong>
                        </div>
                    </div>
                    <div>
                        <strong t-field="o.partner_id.name"/>
                    </div>
                    <div>
                        <strong>Address:</strong>
                        <address t-field="o.partner_id"
                                 t-options='{"widget": "contact", "fields": ["address", "phone", "fax"], "no_marker": false, "no_tag_br": true}'/>
                    </div>

                </div>
            </div>
            <small>
                <div class="row">
                    <div class="col-xs-6">
                        <t t-set="partner_id" t-value="res_company.partner_id"/>
                        <t t-call="base.banks"/>
                    </div>
                    <div class="col-xs-5 col-xs-offset-1">
                        <t t-set="partner_id" t-value="o.partner_id"/>
                        <t t-call="base.banks"/>
                    </div>
                </div>
            </small>

            <div class="row">
                <div class="col-xs-5">
                    <div t-if="res_company.partner_id.vat">
                        <strong>CIF:</strong>
                        <span t-field="res_company.partner_id.vat"/>
                    </div>
                    <div t-if="res_company.partner_id.nrc">
                        <strong>NRC:</strong>
                        <span t-field="res_company.partner_id.nrc"/>
                    </div>
                    <div i-if="res_company.share_capital">
                        <strong>Share Capital:</strong>
                        <span t-field="res_company.share_capital"/>
                    </div>
                </div>
                <div class="col-xs-5 col-xs-offset-2">
                    <div t-if="o.partner_id.vat">
                        <strong>CIF:</strong>
                        <span t-field="o.partner_id.commercial_partner_id.vat"/>
                    </div>
                    <div t-if="o.partner_id.nrc">
                        <strong>NRC:</strong>
                        <span t-field="o.partner_id.commercial_partner_id.nrc"/>
                    </div>
                </div>
            </div>
            <br/>
            <br/>
        </template>

        <template id="report_reception_text">
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th>
                            <strong>Invoice number</strong>
                        </th>
                        <th>
                            <strong>Date</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span t-field="o.reference"/>
                        </td>
                        <td>
                            <span t-field="o.date_invoice" t-options='{"widget": "date"}'/>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div>
                <span>The undersigned, members of the reception, we proceeded to receive material values
                </span>
                <t t-if="o.partner_id">
                    <span>supplied by</span>
                    <strong>
                        <span t-field="o.partner_id.name"/>
                    </strong>
                    <span t-if="o.partner_id.city">
                        from the city
                        <strong>
                            <span t-field="o.partner_id.city"/>
                        </strong>
                    </span>
                    <span>under the invoice no.</span>
                    <strong>
                        <span t-field="o.reference"/>
                    </strong>
                </t>
                <span>ascertained the following:</span>
            </div>
            <br/>
        </template>

        <template id="l10n_ro_report_invoice_reception">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <t t-call="l10n_ro_invoice_report.report_address"/>
                            <h3>
                                <span>Reception:</span>
                                <span t-field="o.number"/>
                            </h3>
                            <t t-call="l10n_ro_invoice_report.report_reception_text"/>
                            <table class="table table-condensed table-bordered">
                                <thead>
                                    <tr>
                                        <th>
                                            <strong>Product</strong>
                                        </th>
                                        <th class="text-right">
                                            <strong>Quantity</strong>
                                        </th>
                                        <th class="text-right">
                                            <strong>Price</strong>
                                        </th>
                                        <th class="text-right">
                                            <strong>Amount</strong>
                                        </th>
                                        <th class="text-right">
                                            <strong>VAT</strong>
                                        </th>
                                        <th class="text-right">
                                            <strong>Amount with VAT</strong>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="o.invoice_line_ids" t-as="line">
                                        <td>
                                            <span t-field="line.product_id"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.quantity"/>
                                            <span t-field="line.uom_id" groups="product.group_uom"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_unit"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_subtotal"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_taxes"/>
                                        </td>
                                        <td class="text-right">
                                            <t t-set="total_value" t-value="line.price_subtotal + line.price_taxes"/>
                                            <span t-esc="total_value" t-esc-options="{'widget': 'float', 'decimal_precision':'Product Price'}"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="row">
                                <div class="col-xs-4 pull-right">
                                    <table class="table table-condensed">
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total Without VAT</strong>
                                            </td>
                                            <td class="text-right">
                                                <span t-field="o.amount_untaxed" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>VAT</td>
                                            <td class="text-right">
                                                <span t-field="o.amount_tax" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                        </tr>
                                        <tr class="border-black">
                                            <td>
                                                <strong>Total</strong>
                                            </td>
                                            <td class="text-right">
                                                <span t-field="o.amount_total" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th>Reception Committee:</th>
                                        <th>Received in storage:</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Name</td>
                                        <td>Name</td>
                                    </tr>
                                    <tr>
                                        <td>Signature</td>
                                        <td>Signature</td>
                                    </tr>
                                    <tr>
                                        <td>Date</td>
                                        <td>Date</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="oe_structure"/>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</openerp>
